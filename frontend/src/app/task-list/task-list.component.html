<div class="w-screen h-screen overflow-x-hidden overflow-y-auto bg-gray-50">
  <div class="w-full min-h-9 flex py-4 px-0 justify-center mb-8">
    <div class="w-10/12 max-w-[1400px] flex justify-between items-center">
      <h1 class="text-xl font-black text-gray-800 uppercase m-0">
        Todo App
        <span class="block text-xs text-gray-500">Trabajando en crecer</span>
      </h1>
      <button
        class="rounded-[21px] bg-gray-900 text-gray-100 py-3 px-6 text-xs uppercase transition-all duration-300 hover:bg-blue-600 hover:text-blue-100"
        color="primary"
        (click)="openTaskModal()"
      >
        Nueva Tarea
      </button>
    </div>
  </div>

  <div class="block w-full min-h-screen ld:w-10/12 lg:max-w-[1400px] lg:min-h-[400px] mx-auto lg:flex lg:gap-4">
    <div class="w-full px-4 lg:w-[calc(100%-300px)] bg-gray-100 lg:px-10 py-6 lg:rounded-[12px] overflow-hidden">
      <div class="w-full flex justify-between items-center mb-6">
        <button
          class="hidden lg:block rounded-[21px] bg-gray-900 text-gray-100 py-3 px-6 text-xs uppercase transition-all duration-300 hover:bg-blue-600 hover:text-blue-100"
          mat-raised-button
          (click)="loadTasks()"
        >
          Actualizar
        </button>
        <div class="w-full gap-2 flex lg:gap-4">
          <mat-form-field class="w-1/2 overflow-hidden">
            <mat-label>Filtrar por categoría</mat-label>
            <mat-select
              class="border-none bg-transparent"
              (selectionChange)="filterByCategory($event.value)"
            >
              <mat-option
                *ngFor="let category of categories"
                [value]="category"
              >
                {{ category }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field class="w-1/2 overflow-hidden">
            <mat-label>Filtrar por estado</mat-label>
            <mat-select (selectionChange)="filterByStatus($event.value)">
              <mat-option value="all">Todas</mat-option>
              <mat-option value="completed">Completadas</mat-option>
              <mat-option value="pending">Pendientes</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <div *ngIf="loading$ | async">
        <mat-spinner></mat-spinner>
      </div>

      <div *ngIf="error$ | async as error">
        <mat-error>Error: {{ error }}</mat-error>
      </div>

      <mat-list
        *ngIf="tasks$ | async as tasks"
        class="grid grid-cols-12 gap-6 py-4"
      >
        <mat-list-item
          *ngFor="let task of tasks"
          class="border-b cursor-pointer col-span-12 md:col-span-6 lg:col-span-4 bg-white block p-0 h-[305px] overflow-hidden rounded-[21px]"
          (click)="openTaskDetailModal(task)"
        >
          <div class="overflow-hidden w-full h-36">
            <img
              *ngIf="task.imageUrl"
              [src]="task.imageUrl"
              alt="Task Image"
              class="w-full h-full object-cover"
            />
            <img
              *ngIf="!task.imageUrl"
              src="https://res.cloudinary.com/dalvenjha/image/upload/v1721383219/oibe7ytivwpyu5jsp5nw.webp"
              alt="Task Image"
              class="w-full h-full object-cover"
            />
          </div>
          <div class="items-center w-full p-4">
            <div class="h-24 w-full">
              <h3 class="text-base font-semibold uppercase m-0 mb-2">
                {{ task.title }}
              </h3>
              <p class="text-gray-600 text-sm w-full overflow-hidden whitespace-normal">
                {{ task.description | slice : 0 : 50
                }}{{ task.description.length > 50 ? "..." : "" }}
              </p>
            </div>
            <div class="flex justify-between items-center">
              <div class="flex">
                <button
                  mat-icon-button
                  (click)="
                    updateTask(getUpdatedTask(task)); $event.stopPropagation()
                  "
                  class="bg-gray-800 scale-75 text-gray-200 transition-all duration-300 hover:bg-blue-500 hover:text-gray-50"
                >
                  <mat-icon class="scale-75 p-0">{{
                    task.completed ? "check_box" : "check_box_outline_blank"
                  }}</mat-icon>
                </button>
                <button
                  mat-icon-button
                  (click)="openTaskModal(task); $event.stopPropagation()"
                  class="bg-gray-800 scale-75 text-gray-200 transition-all duration-300 hover:bg-red-500 hover:text-gray-50"
                >
                  <mat-icon class="scale-75 p-0">edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  (click)="deleteTask(task.taskId); $event.stopPropagation()"
                  class="bg-gray-800 scale-75 text-gray-200 transition-all duration-300 hover:bg-orange-400 hover:text-gray-50"
                >
                  <mat-icon class="scale-75 p-0">delete</mat-icon>
                </button>
              </div>
              <div>
                <span
                  [ngClass]="[
                    'px-5 py-1 text-gray-100 rounded-tl-full rounded-bl-full mr-[-16px] text-sm',
                    getCategoryColorClass(task.category)
                  ]"
                  >{{ task.category }}</span
                >
              </div>
            </div>
          </div>
        </mat-list-item>
      </mat-list>

      <mat-paginator
        [length]="filteredTotalTasks$ | async"
        [pageSize]="10"
        [pageSizeOptions]="[5, 10, 25, 100]"
        (page)="onPageChange($event)"
        class="bg-transparent mt-6"
      >
      </mat-paginator>
    </div>
    <div class="hidden lg:block w-[300px] pl-4">
      <div class="flex justify-between items-center pb-10 border-b border-gray-200 mb-10">
        <h2 class="text-lg m-0 p-0">Hola, <span class="font-bold block text-xl">José Luis</span></h2>
        <div class="rounded-full h-28 w-28 overflow-hidden">
          <img src="https://res.cloudinary.com/dalvenjha/image/upload/v1721639875/nkuh2aurzn9iy2gvfpx8.jpg" alt="" />
        </div>
      </div>
      <div class="grid grid-cols-12 gap-4 mb-10 pb-10 border-b border-gray-200">
        <div class="col-span-6">
          <h4 class="text-sm uppercase font-medium mb-4">Tareas</h4>
          <p class="text-3xl pl-6 border-l-2 border-orange-400 font-bold">{{ totalTasks$ | async }}</p>
        </div>
        <div class="col-span-6">
          <h4 class="text-sm uppercase font-medium mb-4">Filtradas</h4>
          <p class="text-3xl pl-6 border-l-2 border-blue-400 font-bold">{{ filteredTotalTasks$ | async }}</p>
        </div>
        <div class="col-span-12">
          <h4 class="text-sm uppercase font-medium mb-4">Página</h4>
          <p class="text-3xl pl-6 border-l-2 border-red-400 font-bold">{{ currentPage$ | async }} of {{ totalPages$ | async }}</p>
        </div>
      </div>
      <div class="grid grid-cols-12 gap-4 mb-10 pb-10">
        <div class="col-span-6">
          <h4 class="text-sm uppercase font-medium mb-4">Categorías</h4>
          <p class="text-3xl pl-6 border-l-2 border-lime-600 font-bold">6</p>
        </div>
        <div class="col-span-6">
          <h4 class="text-sm uppercase font-medium mb-4">Estados</h4>
          <p class="text-3xl pl-6 border-l-2 border-indigo-600 font-bold">2</p>
        </div>
      </div>
    </div>
  </div>
</div>
